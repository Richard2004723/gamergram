<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GamerGram - Share Your Wins</title>

    <link href="./style.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-black text-slate-200 min-h-screen antialiased">

    <div id="notification-container" class="fixed top-5 right-5 z-[100]"></div>

    <div class="min-h-screen md:flex">

        <aside id="sidebar" class="hidden md:flex w-72 flex-col p-5 gap-6 border-r border-slate-800/50 bg-black">
            <div class="flex items-center gap-3">
                <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-black text-lg font-bold">G</div>
                <div><h1 class="text-xl font-semibold">GamerGram</h1></div>
            </div>

            <nav aria-label="Main Navigation" class="flex-1">
                <ul class="flex flex-col gap-2">
                    <li><a href="#home" data-page="home" class="nav-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg><span>Home</span></a></li>
                    <li><a href="#explore" data-page="explore" class="nav-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><span>Explore</span></a></li>
                    <li><a href="#messages" data-page="messages" class="nav-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>Messages</span></a></li>
                    <li><a href="#upload" data-page="upload" class="nav-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9l-1.6-4.8c-.4-1.3-1.6-2.3-3-2.3H6.7c-1.4 0-2.6.9-3 2.2l-1.6 4.8c-.3 1.4 0 2.7.7 3.9l4.3 6.1c.7 1 1.8 1.6 3 1.6h2.2c1.2 0 2.3-.6 3-1.6l4.3-6.1z"/><path d="m7.8 15.7 4.2-2.9 4.2 2.9"/></svg><span>Create Post</span></a></li>
                    <li><a href="#profile" data-page="profile" class="nav-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg><span id="sidebar-profile-link">Profile</span></a></li>
                </ul>
            </nav>

            <div class="mt-auto space-y-2">
                 <button id="logout-btn" class="w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-red-500/10 text-red-400">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3" stroke-width="1.5"></path></svg>
                    <span>Log Out</span>
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-black">
            <div class="flex-1 overflow-auto md:p-4">
                <section id="page-home" class="page-content active">
                     <div class="grid grid-cols-1 lg:grid-cols-3 max-w-7xl mx-auto gap-8 p-4">
                        <div class="lg:col-span-2 space-y-8">
                            <h2 class="text-2xl font-bold">Home Feed</h2>
                            <div id="feed-container" class="space-y-8">
                                <p class="text-center text-slate-400">Loading posts...</p>
                            </div>
                        </div>
                        <aside class="hidden lg:block space-y-8">
                            <div class="bg-[#1a1a1a] p-4 rounded-xl border border-slate-800">
                                <h3 class="font-bold mb-4 text-purple-400">Notifications</h3>
                                <div id="notification-panel" class="space-y-3">
                                    <p class="text-sm text-slate-400">No new notifications.</p>
                                </div>
                            </div>
                            <div class="bg-[#1a1a1a] p-4 rounded-xl border border-slate-800">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-bold text-purple-400">Public Groups</h3>
                                    <button id="create-group-btn" class="text-purple-400 text-2xl" title="Create New Group">+</button>
                                </div>
                                <div id="groups-panel" class="space-y-3">
                                    <p class="text-sm text-slate-400">Loading groups...</p>
                                </div>
                            </div>
                        </aside>
                     </div>
                </section>
                <section id="page-explore" class="page-content hidden space-y-6 max-w-4xl mx-auto p-4">
                    <h2 class="text-2xl font-bold">Explore Users</h2>
                    <div class="relative">
                        <input id="user-search-input" type="text" placeholder="Search for users..." class="w-full bg-transparent p-3 pl-10 rounded-lg border border-slate-700 focus:outline-none focus:border-purple-500">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </div>
                    <div id="explore-users-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                        <p class="text-slate-400">Loading users...</p>
                    </div>
                </section>
                 <section id="page-messages" class="page-content hidden max-w-4xl mx-auto p-4 w-full">
                    <h2 class="text-2xl font-bold mb-4">Messages</h2>
                    <div id="messages-container"></div>
                </section>
                <section id="page-upload" class="page-content hidden space-y-6 max-w-2xl mx-auto p-4">
                    <h2 class="text-2xl font-bold">Create Post</h2>
                    <div class="bg-[#1a1a1a] p-4 md:p-6 rounded-xl">
                        <form id="create-post-form" class="space-y-4">
                            <label class="block"><span class="text-sm text-slate-300">Caption</span>
                                <input id="post-caption" type="text" placeholder="Your amazing gaming moment..." class="mt-1 block w-full rounded-md bg-transparent outline-none px-3 py-2 border border-slate-700 focus:border-purple-500" required />
                            </label>
                            <label class="block"><span class="text-sm text-slate-300">Tags</span>
                                <input id="post-tags" type="text" placeholder="#Valorant #Clutch" class="mt-1 block w-full rounded-md bg-transparent outline-none px-3 py-2 border border-slate-700 focus:border-purple-500" />
                            </label>
                            <label class="block"><span class="text-sm text-slate-300">Media (Image or Video)</span>
                                <input id="post-media-upload" type="file" accept="image/*,video/*" class="mt-1 block w-full text-sm" required />
                            </label>
                            <div id="post-media-preview-container" class="rounded-md overflow-hidden bg-black/30 aspect-[16/9] flex items-center justify-center text-slate-400">Preview will appear here</div>
                            <div class="flex items-center justify-between pt-2">
                                <button type="button" id="cancel-upload-btn" class="px-4 py-2 rounded-md bg-slate-700 hover:bg-slate-600 font-semibold">Cancel</button>
                                <button type="submit" id="submit-post-btn" class="px-4 py-2 rounded-md bg-purple-500 text-white font-semibold">Post</button>
                            </div>
                        </form>
                    </div>
                </section>
                <section id="page-profile" class="page-content hidden">
                    <div id="profile-container" class="max-w-4xl mx-auto"><p class="text-slate-400 p-4">Loading profile...</p></div>
                </section>
                 <section id="page-chat" class="page-content hidden flex flex-col h-full max-h-[calc(100vh-120px)] md:max-h-[100vh]">
                     <div id="chat-container" class="flex flex-col h-full max-w-4xl mx-auto w-full"></div>
                 </section>
            </div>

            <nav class="md:hidden sticky bottom-0 left-0 w-full z-30 bg-black border-t border-slate-800">
                <div class="flex items-center justify-around p-2">
                    <a href="#home" data-page="home" class="nav-link mobile-nav p-3 rounded-full"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a>
                    <a href="#explore" data-page="explore" class="nav-link mobile-nav p-3 rounded-full"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></a>
                     <a href="#messages" data-page="messages" class="nav-link mobile-nav p-3 rounded-full"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></a>
                    <a href="#upload" data-page="upload" class="nav-link mobile-nav p-3 rounded-full"><svg class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9l-1.6-4.8c-.4-1.3-1.6-2.3-3-2.3H6.7c-1.4 0-2.6.9-3 2.2l-1.6 4.8c-.3 1.4 0 2.7.7 3.9l4.3 6.1c.7 1 1.8 1.6 3 1.6h2.2c1.2 0 2.3-.6 3-1.6l4.3-6.1z"/><path d="m7.8 15.7 4.2-2.9 4.2 2.9"/></svg></a>
                    <a href="#profile" data-page="profile" class="nav-link mobile-nav p-1.5 rounded-full">
                        <img id="nav-profile-pic" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" class="w-8 h-8 rounded-full object-cover">
                    </a>
                </div>
            </nav>
        </main>
    </div>

    <!-- Modals will be rendered here by JS -->
    <div id="modal-container"></div>
    
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, addDoc, getDocs, query, where, onSnapshot, updateDoc, arrayUnion, arrayRemove, writeBatch, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

    // --- Firebase Initialization ---
    const firebaseConfig = {
      apiKey: "AIzaSyB2aJP1_9HA05T-F7ibtUh29XWAHRmCCdg",
      authDomain: "gamergram-9a855.firebaseapp.com",
      projectId: "gamergram-9a855",
      storageBucket: "gamergram-9a855.appspot.com",
      messagingSenderId: "225075637418",
      appId: "1:225075637418:web:9d094d12fd811e21cf74d3",
      measurementId: "G-0Y9L8CHJFQ"
    };
    const appId = 'gamergram-app';
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- State Variables ---
    let currentUser = null;
    let currentUserProfile = null;
    let postsUnsubscribe = null;
    let selectedPostFile = null;
    let selectedPfpFile = null;
    let chatUnsubscribe = null;

    // --- DOM Elements ---
    const pages = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');

    // --- Utility Functions ---
    function showNotification(message, isError = false) {
        const container = document.getElementById('notification-container');
        const notif = document.createElement('div');
        notif.textContent = message;
        notif.className = `p-4 rounded-lg shadow-lg text-white ${isError ? 'bg-red-500' : 'bg-green-500'} animate-pulse`;
        container.appendChild(notif);
        setTimeout(() => { notif.remove() }, 4000);
    }
    
    function closeModal() {
        const modalContainer = document.getElementById('modal-container');
        modalContainer.innerHTML = '';
    }

    // --- Auth & App Initialization ---
    onAuthStateChanged(auth, async user => {
        if (user && !user.isAnonymous) {
            currentUser = user;
            await fetchUserProfile(user.uid, true);
            document.querySelector('#sidebar')?.classList.remove('hidden');
            handleHashChange();
        } else {
            window.location.href = './auth.html';
        }
    });

    // --- Data Fetching ---
    async function fetchUserProfile(userId, isCurrentUser = false) {
        const userDocRef = doc(db, `/artifacts/${appId}/public/data/users`, userId);
        const docSnap = await getDoc(userDocRef);
        if (!docSnap.exists()) return null;

        const profileData = { id: docSnap.id, ...docSnap.data() };
        if (isCurrentUser) {
            currentUserProfile = profileData;
            document.getElementById('sidebar-profile-link').textContent = currentUserProfile.username;
            document.getElementById('nav-profile-pic').src = profileData.photoURL || `https://ui-avatars.com/api/?name=${profileData.username.charAt(0)}&background=A78BFA&color=000`;
        }
        return profileData;
    }

    async function fetchUserProfileByUsername(username) {
        const q = query(collection(db, `/artifacts/${appId}/public/data/users`), where("username", "==", username));
        const querySnapshot = await getDocs(q);
        return querySnapshot.empty ? null : { id: querySnapshot.docs[0].id, ...querySnapshot.docs[0].data() };
    }

    // --- SPA Navigation ---
    function showPage(pageId) {
        if (chatUnsubscribe) {
            chatUnsubscribe();
            chatUnsubscribe = null;
        }
        pages.forEach(page => {
            page.classList.toggle('active', page.id === `page-${pageId}`);
            page.classList.toggle('hidden', page.id !== `page-${pageId}`);
        });
        window.scrollTo(0, 0);
        navLinks.forEach(link => {
            const isMobile = link.classList.contains('mobile-nav');
            const activeClass = isMobile ? 'mobile-nav-active' : 'nav-active';
            link.classList.toggle(activeClass, link.dataset.page === pageId);
        });
    }

    function handleHashChange() {
        const hash = window.location.hash.substring(1) || 'home';
        let [pageId, param] = hash.split('=');
        
        const profileLinks = Array.from(document.querySelectorAll('.nav-link[data-page="profile"]'));
        if(profileLinks.length > 0 && currentUserProfile) profileLinks.forEach(l => l.href = `#profile=${currentUserProfile.username}`);

        showPage(pageId);
        
        switch (pageId) {
            case 'home': listenForPosts(); loadNotificationPanel(); loadGroupsPanel(); break;
            case 'explore': loadExplorePage(); break;
            case 'messages': loadMessagesPage(); break;
            case 'profile': loadProfilePage(param || currentUserProfile.username); break;
            case 'chat': loadChatPage(param); break;
        }
    }
    window.addEventListener('hashchange', handleHashChange);
    
    // --- Feed Logic ---
    function listenForPosts() {
        if (postsUnsubscribe) postsUnsubscribe();
        const q = query(collection(db, `/artifacts/${appId}/public/data/posts`), orderBy('createdAt', 'desc'), limit(50));
        postsUnsubscribe = onSnapshot(q, async snapshot => renderFeed(snapshot.docs));
    }
    
    async function renderFeed(postDocs) {
        const feedContainer = document.getElementById('feed-container');
        if (!feedContainer) return;
        if (postDocs.length === 0) {
            feedContainer.innerHTML = '<p class="text-center text-slate-400">No posts yet. Follow users or create a post!</p>'; return;
        }
        const postsHtml = await Promise.all(postDocs.map(async doc => {
            const post = { id: doc.id, ...doc.data() };
            const author = await fetchUserProfile(post.userId);
            if (!author || author.isBanned) return '';
            const isLiked = post.likes.includes(currentUser.uid);
            const mediaElement = post.mediaType === 'video'
                ? `<video src="${post.mediaUrl}" controls class="w-full bg-black"></video>`
                : `<img src="${post.mediaUrl}" alt="Post by ${author.username}" class="w-full bg-black">`;

            return `
            <article class="bg-[#1a1a1a] rounded-xl overflow-hidden border border-slate-800">
                <header class="p-4 flex items-center space-x-3">
                    <a href="#profile=${author.username}"><img src="${author.photoURL || `https://ui-avatars.com/api/?name=${author.username.charAt(0)}&background=A78BFA&color=000`}" class="w-10 h-10 rounded-full object-cover" alt="${author.username}'s avatar"></a>
                    <a href="#profile=${author.username}" class="font-semibold text-white hover:underline">${author.username}</a>
                </header>
                ${mediaElement}
                <div class="p-4">
                    <div class="flex items-center space-x-4">
                       <button class="like-btn" data-post-id="${post.id}">
                            <svg class="w-6 h-6 ${isLiked ? 'text-red-500' : 'text-white'}" xmlns="http://www.w3.org/2000/svg" fill="${isLiked ? 'currentColor' : 'none'}" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 20.25l-7.682-7.682a4.5 4.5 0 010-6.364z"></path></svg>
                        </button>
                        <span class="text-white">${post.likes.length} Likes</span>
                    </div>
                    <p class="text-slate-300 mt-2"><a href="#profile=${author.username}" class="font-semibold text-white hover:underline">${author.username}</a> ${post.caption}</p>
                </div>
            </article>`;
        }));
        feedContainer.innerHTML = postsHtml.join('');
    }

    // --- Explore Page ---
    async function loadExplorePage(searchTerm = '') {
        const grid = document.getElementById('explore-users-grid');
        grid.innerHTML = '<p class="text-slate-400">Loading users...</p>';
        const usersRef = collection(db, `/artifacts/${appId}/public/data/users`);
        const q = query(usersRef, where("isBanned", "==", false));
        const querySnapshot = await getDocs(q);
        
        let users = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (searchTerm) {
            users = users.filter(user => user.username.toLowerCase().includes(searchTerm.toLowerCase()));
        }

        const usersHtml = users
            .filter(user => user.id !== currentUser.uid)
            .map(user => `
                <a href="#profile=${user.username}" class="block bg-[#1a1a1a] border border-slate-800 p-4 rounded-xl text-center hover:border-purple-500 transition">
                    <img src="${user.photoURL || `https://ui-avatars.com/api/?name=${user.username.charAt(0)}&background=A78BFA&color=000`}" class="w-20 h-20 rounded-full mx-auto object-cover">
                    <p class="mt-2 font-semibold truncate">${user.username}</p>
                </a>`).join('');
        grid.innerHTML = usersHtml || '<p class="text-slate-400 col-span-full text-center">No users found.</p>';
    }
    
    // --- Create Post Logic ---
    document.getElementById('post-media-upload')?.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        const preview = document.getElementById('post-media-preview-container');
        if (file) {
            selectedPostFile = file;
            const url = URL.createObjectURL(file);
            if (file.type.startsWith('image/')) {
                preview.innerHTML = `<img src="${url}" alt="preview" class="object-cover w-full h-full"/>`;
            } else if (file.type.startsWith('video/')) {
                preview.innerHTML = `<video src="${url}" controls class="object-cover w-full h-full"></video>`;
            } else {
                 preview.innerHTML = '<span>Unsupported file type</span>';
                 selectedPostFile = null;
            }
        }
    });

    document.getElementById('create-post-form')?.addEventListener('submit', async (e) => {
         e.preventDefault();
         if (!selectedPostFile) { showNotification("Please select an image or video.", true); return; }
         const submitBtn = document.getElementById('submit-post-btn');
         submitBtn.disabled = true;
         submitBtn.textContent = 'Uploading...';

         try {
            const fileType = selectedPostFile.type.startsWith('image/') ? 'image' : 'video';
            const storageRef = ref(storage, `posts/${currentUser.uid}/${Date.now()}_${selectedPostFile.name}`);
            const snapshot = await uploadBytes(storageRef, selectedPostFile);
            const downloadURL = await getDownloadURL(snapshot.ref);
            await addDoc(collection(db, `/artifacts/${appId}/public/data/posts`), {
                userId: currentUser.uid, username: currentUserProfile.username,
                caption: document.getElementById('post-caption').value,
                tags: document.getElementById('post-tags').value,
                mediaUrl: downloadURL,
                mediaType: fileType,
                likes: [], comments: [], createdAt: serverTimestamp()
            });
            e.target.reset();
            document.getElementById('post-media-preview-container').innerHTML = 'Preview will appear here';
            selectedPostFile = null;
            showNotification("Post created successfully!");
            window.location.hash = 'home';
         } catch (error) {
            console.error("Upload Failed:", error);
            let errorMessage = "Failed to create post. See console for details.";
            if (error.code) {
                switch (error.code) {
                    case 'storage/unauthorized':
                        errorMessage = "Permission Denied. Please check your Firebase Storage security rules to allow uploads.";
                        break;
                    case 'storage/canceled':
                        errorMessage = "Upload was canceled.";
                        break;
                    case 'storage/unknown':
                        errorMessage = "An unknown error occurred during upload. Your file might be too large.";
                        break;
                }
            }
            showNotification(errorMessage, true);
         } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Post';
         }
    });

    // --- Profile Page ---
    async function loadProfilePage(username) {
        // ... (implementation for profile page similar to previous versions)
    }

    // --- NEW: Messaging & Groups Logic ---
    async function loadMessagesPage() {
        const container = document.getElementById('messages-container');
        container.innerHTML = 'Loading conversations...';
        // Logic to fetch and display user's private chats and group chats
    }
    
    async function loadChatPage(chatId) {
        const container = document.getElementById('chat-container');
        container.innerHTML = `
            <header class="flex items-center p-4 border-b border-slate-800">
                <a href="#messages" class="p-2 mr-2">&larr;</a>
                <div id="chat-header-info">Loading...</div>
            </header>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
            <footer class="p-4 border-t border-slate-800">
                <div class="flex items-center gap-2">
                    <button class="p-2 hover:bg-slate-700 rounded-full" title="Attach File (future feature)"><svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="currentColor" d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c-1.93 0-3.5 1.57-3.5 3.5v11.5c0 2.76 2.24 5 5 5s5-2.24 5-5V6h-1.5z"/></svg></button>
                    <button class="p-2 hover:bg-slate-700 rounded-full" title="Use Camera (future feature)"><svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="currentColor" d="M12 17.5c-2.48 0-4.5-2.02-4.5-4.5S9.52 8.5 12 8.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7c-1.38 0-2.5 1.12-2.5 2.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5-1.12-2.5-2.5-2.5z"/><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></button>
                    <input type="text" id="chat-message-input" class="flex-1 bg-transparent border border-slate-700 rounded-full px-4 py-2 focus:outline-none focus:border-purple-500" placeholder="Type a message...">
                    <button class="p-2 hover:bg-slate-700 rounded-full" title="Send Voice Note (future feature)"><svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="currentColor" d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg></button>
                    <button id="send-chat-message-btn" class="p-2 bg-purple-500 rounded-full"><svg class="w-6 h-6 text-white" viewBox="0 0 24 24"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
                </div>
            </footer>
        `;
        // ... logic to fetch chat details and listen for messages
    }
    
    async function loadNotificationPanel() { /* ... */ }
    async function loadGroupsPanel() { /* ... */ }

    // --- Master Event Listener ---
    document.body.addEventListener('click', async (e) => {
        // ... (master event listener logic)
    });

    // --- Search Logic ---
    document.getElementById('user-search-input')?.addEventListener('input', (e) => {
        loadExplorePage(e.target.value);
    });
</script>
</body>
</html>

